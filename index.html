<!DOCTYPE html>
<html>
<head lang="zh-cn">
    <meta charset="UTF-8">
    <title>ToarunoMusicPlayer</title>
    <link rel="stylesheet" href="css/materialize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
</head>
<body>
<section class="container row valign-wrapper">
    <section class="col l8 offset-l2 valign content-wrapper z-depth-1 indigo hoverable">

        <a class="col l1 valign-wrapper waves-effect waves-circle menu-btn">
            <i class="valign small material-icons white-text menu-icon mdi-av-queue-music"></i>
        </a>
        <section class="col l10 offset-l1 player-content ">
            <img class="cover z-depth-1 hoverable" src="img/cover.jpg" alt="cover"/>
            <img class="background-cover" src="img/cover.jpg" alt="cover"/>

            <div class="background-mask"></div>
            <section class="about col l7 right">
                <h1 class="title white-text">Test-moi</h1>

                <h2 class="subtitle white-text">Hans Zimmer / Richard Harvey</h2>

                <section class="player-controller white col l12 valign-wrapper z-depth-1">
                    <section class="progress-wrapper col l12">
                        <section class="progress-bar red z-depth-1 hoverable"></section>
                    </section>
                    <div class="col l5_12 valign valign-wrapper">
                        <a class="waves-effect waves-circle ctrl center-block valign-wrapper valign" id="order">
                            <i class="small material-icons black-text valign mdi-av-repeat"></i>
                        </a>
                    </div>
                    <div class="col l5_12 valign valign-wrapper">
                        <a class="waves-effect waves-circle ctrl center-block valign-wrapper valign" id="prev">
                            <i class="small material-icons black-text valign mdi-av-skip-previous"></i>
                        </a>
                    </div>
                    <div class="col l5_12 valign valign-wrapper">
                        <a class="btn-floating btn-large waves-effect waves-light red center-block valign valign-wrapper pause"
                           id="play">
                            <i class="large material-icons black-text valign mdi-av-play-arrow" id="play_icon"></i>
                            <i class="large material-icons black-text valign mdi-av-pause" id="pause_icon"></i>
                        </a>
                    </div>
                    <div class="col l5_12 valign valign-wrapper">
                        <a class="waves-effect waves-circle ctrl center-block valign valign-wrapper" id=next">
                            <i class="small material-icons black-text valign mdi-av-skip-next"></i>
                        </a>
                    </div>
                    <div class="col l5_12 valign valign-wrapper">
                        <a class="waves-effect waves-circle ctrl center-block valign valign-wrapper" id=more">
                            <i class="small material-icons black-text valign mdi-navigation-more-vert"></i>
                        </a>
                    </div>
                </section>
            </section>
        </section>
        <footer class="col l12 player-footer grey darken-4 center-align">
            <a class="waves-effect waves-red info-btn" id="menu" data-status="detail">
                <i class="small circle-icon white-text circle"></i>
            </a>
        </footer>
    </section>
</section>
<script src="js/jquery-2.1.4-min.js"></script>
<script src="js/materialize.min.js"></script>
<script>
    var audio = document.createElement("audio");

    $(document).ready(function () {
        loadMusic();

        var player_status = $("#play").attr("data-status");
    });

    $("#play").click(function () {
        var status = $("#play").attr("data-status");
        $("#play_icon").toggle();
        $("#pause_icon").toggle();
        $("#play").toggleClass("play pause");
        if ($("#play").hasClass("pause")) {
            controlMusic(0);
        } else {
            controlMusic(1);
        }
    });

    //点击进度条跳转到该位置
    $(".progress-wrapper").click(function (e) {
        var progress = e.offsetX * 100 / $(".progress-wrapper").width();
        var newPosition = new Number(progress);
        $(".progress-bar").css("width", newPosition.toFixed(2) + "%");
        var cur = newPosition.toFixed(0) * audio.duration / 100;
        audio.currentTime = cur;
        audio.play();
        console.log(cur);
    });

    $("#menu").click(function () {
        var status = $("#menu").attr("data-status");
        $(".about").toggleClass("l12", "l7 right");

        if (status == "detail") {
            $("#menu").attr("data-status", "outline");
            $(".cover").css("opacity", 0).css("z-index", "0");
            $(".background-mask").css("opacity", 1);
            $(".background-cover").css("-webkit-filter", "blur(5px)").css("opacity", "1");
        } else if (status == "outline") {
            $("#menu").attr("data-status", "detail");
            $(".cover").css("opacity", 1).css("z-index", "999");
            $(".background-mask").css("opacity", 0);
            $(".background-cover").css("-webkit-filter", "blur(0)").css("opacity", "0");
        }
    });

    var loadMusic = function () {
        audio.setAttribute("src", "music/suis-moi.mp3");
    };

    var controlMusic = function (pause) {
        var duration = audio.duration;
        pause ? audio.play() : audio.pause();
        setInterval(function () {
            var progress = new Number(audio.currentTime * 100 / duration);
            $(".progress-bar").css("width", progress.toFixed(2) + "%");
        }, 1000);
    };

    //歌曲播放完毕
    audio.addEventListener("ended", function () {
        audio.currentTime = 0;
        audio.play();
    })


</script>
</body>
</html>